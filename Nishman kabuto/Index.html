<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ISTANBUL GROOMING CO. | NISHMAN & KABUTO</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;500;700&family=Playfair+Display:wght@700&family=Noto+Sans+Hebrew:wght@400;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">

    <style>
        :root { --gold: #D4AF37; --neon-red: #ff0000; }
        
        body {
            font-family: 'Oswald', sans-serif;
            color: #ffffff;
            margin: 0;
            background: #050505;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* FONDO DIN√ÅMICO */
        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.92)), url('https://images.unsplash.com/photo-1585747860715-2ba37e788b70?q=80&w=2074&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            z-index: -2;
            animation: kenBurns 60s infinite alternate linear;
        }
        @keyframes kenBurns { 0% { transform: scale(1); } 100% { transform: scale(1.15); } }

        /* KATANA PALPITANTE */
        .katana-pulse {
            color: var(--neon-red);
            text-shadow: 0 0 5px var(--neon-red), 0 0 10px var(--neon-red);
            animation: neonPulse 1.5s infinite alternate ease-in-out;
        }
        @keyframes neonPulse {
            0% { opacity: 0.8; text-shadow: 0 0 5px var(--neon-red); }
            100% { opacity: 1; text-shadow: 0 0 20px var(--neon-red), 0 0 30px var(--neon-red); transform: scale(1.02); }
        }

        /* LED FLASH EN COMBOS */
        .led-flash {
            background: linear-gradient(45deg, #cc0000, #ff0000);
            box-shadow: 0 0 15px #ff0000;
            animation: ledBlink 0.8s infinite alternate;
            color: white; padding: 4px 10px; border-radius: 4px;
            font-size: 10px; font-weight: bold; position: absolute; top: 10px; left: 10px; z-index: 10;
        }
        @keyframes ledBlink { 0% { opacity: 1; box-shadow: 0 0 5px #ff0000; } 100% { opacity: 0.7; box-shadow: 0 0 20px #ff0000; } }

        .gold-text { color: var(--gold); }
        .bg-gold { background-color: var(--gold) !important; color: black !important; }

        .glass-card {
            background: rgba(20, 20, 20, 0.85); backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; overflow: hidden;
            transition: all 0.3s ease;
        }

        .nav-glass { background: rgba(0, 0, 0, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        
        .cat-btn { background: rgba(255, 255, 255, 0.1); border: 1px solid #444; color: #ccc; border-radius: 50px; padding: 8px 16px; font-weight: bold; font-size: 11px; white-space: nowrap; transition: all 0.3s; }
        .cat-btn.active { background: var(--gold); color: black; border-color: var(--gold); transform: scale(1.05); }
        
        .hide { display: none !important; }

        .btn-main { background: var(--gold); color: black; font-weight: 800; box-shadow: 0 5px 20px rgba(212, 175, 55, 0.3); transition: all 0.2s; }
        .btn-main:active { transform: scale(0.95); }

        .old-price { text-decoration: line-through; color: #666; font-size: 0.8em; margin-right: 5px; }

        .bundle-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px;
            background: rgba(0,0,0,0.6); padding: 8px; border-radius: 10px; margin: 10px 0; border: 1px solid #333;
        }
        .bundle-grid img { width: 100%; height: 45px; object-fit: contain; }

        /* ANIMACI√ìN DE EMOJI LE√ìN */
        @keyframes lionEmojiPulse {
            0% { transform: scale(1); filter: drop-shadow(0 0 5px rgba(212,175,55,0.5)); }
            50% { transform: scale(1.2); filter: drop-shadow(0 0 15px rgba(212,175,55,1)); }
            100% { transform: scale(1); filter: drop-shadow(0 0 5px rgba(212,175,55,0.5)); }
        }
        .lion-emoji {
            font-size: 3.5rem;
            animation: lionEmojiPulse 2s infinite ease-in-out;
            cursor: pointer;
            line-height: 1;
            user-select: none;
        }

        .input-error { border-color: #ff0000 !important; box-shadow: 0 0 10px #ff0000 !important; }

        ::-webkit-scrollbar { width: 0px; background: transparent; }
    </style>
</head>
<body class="ltr">

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp, getDocs, query, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const fbApp = initializeApp(firebaseConfig);
        const auth = getAuth(fbApp);
        const db = getFirestore(fbApp);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'istanbul-grooming';

        window.logVisit = async function() {
            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'visitas'), {
                    fecha: serverTimestamp(),
                    idioma: window.app.lang || 'es',
                    platform: navigator.platform
                });
            } catch(e) {}
        }
        
        window.showAdmin = async function() {
            const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'visitas'), limit(20));
            const snap = await getDocs(q);
            let html = '<div class="p-6 bg-black min-h-screen text-white"><h2 class="text-gold text-2xl font-bold mb-4">PANEL ADMIN</h2><button onclick="document.getElementById(\'admin-panel\').classList.add(\'hide\')" class="mb-4 bg-red-600 px-4 py-2 rounded">Cerrar</button><div class="space-y-2">';
            snap.forEach(doc => { const d = doc.data(); html += `<div class="p-2 border border-gray-800 text-[10px]">Log: ${d.idioma} - ${new Date(d.fecha?.seconds*1000).toLocaleString()}</div>`; });
            html += '</div></div>';
            document.getElementById('admin-panel').innerHTML = html;
            document.getElementById('admin-panel').classList.remove('hide');
        }

        onAuthStateChanged(auth, (user) => { if(!user) signInAnonymously(auth); else window.logVisit(); });
    </script>

    <audio id="snd-add" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>

    <!-- NAVBAR -->
    <nav class="fixed top-0 w-full z-50 nav-glass px-4 py-3 shadow-2xl">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div onclick="app.setView('shop')" class="flex flex-col cursor-pointer leading-none">
                <span class="text-xl font-bold tracking-widest text-white uppercase">ISTANBUL</span>
                <span class="text-[9px] font-bold gold-text tracking-[0.4em] uppercase">GROOMING CO.</span>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="app.toggleCurrency()" id="btn-curr" class="text-[10px] font-bold border border-gray-600 px-3 py-1 rounded text-gold bg-black/50">‚Ç™ ILS</button>
                <div class="flex bg-gray-900 rounded border border-gray-700 overflow-hidden">
                    <button onclick="app.setLang('es')" id="l-es" class="px-2 py-1 text-[10px] font-bold bg-white text-black">ES</button>
                    <button onclick="app.setLang('en')" id="l-en" class="px-2 py-1 text-[10px] text-gray-400">EN</button>
                    <button onclick="app.setLang('he')" id="l-he" class="px-2 py-1 text-[10px] text-gray-400">HE</button>
                </div>
                <div onclick="app.toggleCart()" class="relative p-2 cursor-pointer group">
                    <i class="fa-solid fa-cart-shopping text-xl text-gray-300 group-hover:text-gold transition"></i>
                    <span id="badge" class="absolute -top-1 -right-1 bg-gold text-black text-[9px] font-bold w-4 h-4 flex items-center justify-center rounded-full shadow-lg">0</span>
                </div>
            </div>
        </div>
    </nav>

    <div id="admin-panel" class="fixed inset-0 z-[200] hide bg-black overflow-y-auto"></div>

    <main id="main-content" class="pt-24 px-4 max-w-7xl mx-auto pb-32">
        
        <!-- TIENDA -->
        <section id="view-shop">
            <header class="text-center py-6">
                <h1 class="text-5xl md:text-7xl font-bold font-serif tracking-widest leading-none">NISHMAN</h1>
                <span class="text-gold text-3xl md:text-5xl font-serif">&</span>
                <h1 class="text-5xl md:text-7xl font-bold font-serif tracking-widest leading-none">KABUTO</h1>
                <h2 class="text-4xl md:text-6xl font-bold tech katana-pulse mt-2 tracking-widest" style="font-family: 'Orbitron', sans-serif;">KATANA</h2>
                <p id="txt-hero-sub" class="text-gray-100 text-[10px] tracking-[0.3em] uppercase bg-black/50 inline-block px-4 py-1 rounded border border-gray-500 font-bold mt-2">Distribuidor Oficial Exclusivo</p>
                <div class="mt-6">
                    <button onclick="app.setView('b2b')" class="bg-gold text-black px-6 py-2 rounded-full font-bold uppercase text-[10px] tracking-widest shadow-lg hover:bg-white transition-all">
                        <i class="fa-solid fa-briefcase mr-1"></i> <span id="txt-btn-b2b">VENTAS AL MAYOR</span>
                    </button>
                </div>
            </header>

            <!-- COMBOS -->
            <div class="mb-10">
                <h3 id="txt-combo-title" class="text-center gold-text text-sm font-bold uppercase mb-4 tracking-widest">PAQUETES PROFESIONALES (AHORRO)</h3>
                <div id="combo-grid" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
            </div>

            <!-- FILTROS -->
            <div class="sticky top-[60px] z-40 bg-black/80 backdrop-blur-md py-3 mb-6 border-y border-gray-800 overflow-x-auto no-scrollbar">
                <div id="cats-container" class="flex gap-2 justify-start md:justify-center px-4 min-w-max"></div>
            </div>

            <!-- PRODUCTOS -->
            <div id="product-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 pb-24 text-left"></div>
        </section>

        <!-- B2B (FORMULARIO DISTRIBUIDOR) - SIN FORM TAG PARA EVITAR ERRORES -->
        <section id="view-b2b" class="hide py-12">
            <div class="max-w-xl mx-auto glass-card p-6 md:p-8 border-t-4 border-gold shadow-2xl">
                <div class="text-center mb-6">
                    <i class="fa-solid fa-handshake-simple text-4xl gold-text mb-3"></i>
                    <h2 id="txt-b2b-modal-title" class="text-xl font-bold text-white mb-2 uppercase">ZONA DISTRIBUIDOR</h2>
                    <p class="text-gray-400 text-xs">Precios especiales para barber√≠as.</p>
                </div>
                <!-- NO USAR FORM TAG AQUI -->
                <div class="space-y-4">
                    <input type="text" id="in-b2b-name" placeholder="Nombre de Contacto" class="w-full bg-[#111] border border-gray-700 p-4 rounded-xl text-sm text-white outline-none">
                    <input type="text" id="in-b2b-city" placeholder="Nombre de Barber√≠a / Ciudad" class="w-full bg-[#111] border border-gray-700 p-4 rounded-xl text-sm text-white outline-none">
                    <!-- NUEVO CAMPO DE DESCRIPCI√ìN -->
                    <textarea id="in-b2b-desc" placeholder="Mensaje / Productos de inter√©s..." rows="3" class="w-full bg-[#111] border border-gray-700 p-4 rounded-xl text-sm text-white outline-none"></textarea>
                    
                    <button onclick="app.handleB2B()" class="w-full bg-gold text-black font-bold py-4 rounded-xl uppercase text-xs tracking-widest hover:brightness-110 transition">ENVIAR SOLICITUD WHATSAPP</button>
                </div>
                <button onclick="app.setView('shop')" class="mt-4 w-full text-xs text-gray-500 uppercase tracking-widest">VOLVER</button>
            </div>
        </section>
    </main>

    <!-- FOOTER -->
    <footer class="bg-black/95 border-t border-gray-900 text-center py-12">
        <div class="flex justify-center gap-8 mb-6">
            <a href="https://www.facebook.com/profile.php?id=61585384787535" target="_blank" class="text-2xl gold-text hover:text-white transition"><i class="fa-brands fa-facebook"></i></a>
            <a href="https://www.instagram.com/istambulgroomingco/" target="_blank" class="text-2xl gold-text hover:text-white transition"><i class="fa-brands fa-instagram"></i></a>
            <a href="https://wa.me/12136761753" target="_blank" class="text-2xl gold-text hover:text-white transition"><i class="fa-brands fa-whatsapp"></i></a>
        </div>
        <p class="text-xs gold-text tracking-[0.3em] uppercase font-bold cursor-pointer select-none">ISTANBUL GROOMING CO.</p>
        <div class="mt-4 border-t border-gray-800 pt-4 w-1/2 mx-auto">
            <p class="text-[10px] text-gray-500 uppercase font-bold tracking-widest">Victor Carri√≥n - Gerente</p>
        </div>
    </footer>

    <!-- EMOJI LE√ìN ASESOR -->
    <div id="robot-container" class="fixed bottom-6 right-6 z-[100] flex flex-col items-end">
        <div id="robot-msg" class="bg-white text-black p-4 rounded-2xl rounded-br-none shadow-2xl mb-2 text-[11px] font-bold max-w-[200px] hide">
            <div id="robot-content"></div>
        </div>
        <!-- EMOJI PALPITANTE -->
        <div onclick="app.toggleLion()" class="lion-emoji" role="button">ü¶Å</div>
    </div>

    <!-- MODAL CARRITO -->
    <div id="cart-modal" class="fixed inset-0 bg-black/95 z-[60] hide flex flex-col justify-end">
        <div class="w-full max-w-lg mx-auto bg-[#0a0a0a] h-[95vh] rounded-t-[40px] flex flex-col border-t-2 border-gold shadow-2xl overflow-hidden">
            <div class="p-5 border-b border-gray-900 flex justify-between items-center bg-black">
                <h2 id="txt-cart-title" class="text-lg font-bold gold-text uppercase tracking-widest flex items-center gap-2">CARRITO</h2>
                <button onclick="app.toggleCart()" class="text-gray-400 text-2xl p-2"><i class="fa-solid fa-xmark"></i></button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-5 space-y-6 pb-32 text-left">
                <div id="cart-items" class="space-y-3"></div>

                <div id="upsell-section" class="pt-4 border-t border-gray-900">
                    <h3 id="txt-upsell-title" class="text-[10px] gold-text font-bold uppercase mb-3 tracking-widest text-center">COMPLETA TU PACK</h3>
                    <div id="upsell-grid" class="grid grid-cols-2 gap-2"></div>
                </div>
                
                <div class="space-y-3 pt-4 border-t border-gray-900">
                    <!-- INPUTS SIN FORMULARIO -->
                    <input type="text" id="cust-name" placeholder="Nombre Completo" class="w-full bg-[#111] border border-gray-800 p-3 rounded-xl text-sm text-white focus:border-gold outline-none transition-all">
                    <input type="text" id="cust-addr" placeholder="Direcci√≥n Exacta" class="w-full bg-[#111] border border-gray-800 p-3 rounded-xl text-sm text-white focus:border-gold outline-none transition-all">
                    
                    <div class="flex gap-2">
                        <button type="button" onclick="app.setPayment('card')" id="pay-card" class="flex-1 bg-gold text-black p-3 rounded-xl font-bold text-[10px] uppercase shadow-lg">Tarjeta</button>
                        <button type="button" onclick="app.setPayment('cash')" id="pay-cash" class="flex-1 bg-[#1a1a1a] text-gray-400 p-3 rounded-xl font-bold text-[10px] uppercase">Efectivo</button>
                    </div>
                    <div id="payment-details" class="bg-[#0f0f0f] p-3 rounded-xl border border-gray-800 text-xs hide"></div>
                </div>
            </div>

            <div class="absolute bottom-0 left-0 w-full p-5 bg-black border-t border-gray-900">
                <div class="flex justify-between items-center mb-3">
                    <span id="txt-total-label" class="text-xs text-gray-400 font-bold">TOTAL A PAGAR</span>
                    <span id="final-total" class="text-3xl font-bold gold-text">0 ‚Ç™</span>
                </div>
                <!-- BOT√ìN BLINDADO -->
                <button type="button" onclick="app.checkout()" id="btn-final-order" class="btn-main w-full py-4 rounded-xl text-xs font-bold uppercase tracking-widest hover:brightness-110">CONFIRMAR PEDIDO (WHATSAPP)</button>
            </div>
        </div>
    </div>

    <script>
        const app = {
            whatsapp: "12136761753", rate: 3.8, lang: 'es', curr: 'ILS', cart: [], payMethod: 'card', adminTimer: null,
            
            bundles: [
                {
                    id:'b1', n:'ü•â PACK B√ÅSICO', p:120, old:140, 
                    i:'https://i.ibb.co/fd7XDP0h/image.jpg', 
                    imgs: ['https://i.ibb.co/fd7XDP0h/image.jpg', 'https://i.ibb.co/JWLQ100r/image.jpg'],
                    d:{es:'2 Ceras Nishman a elecci√≥n.', en:'2 Nishman Waxes of choice.', he:'2 ◊ï◊ï◊ß◊° ◊†◊ô◊©◊û◊ü ◊ú◊ë◊ó◊ô◊®◊î.'}, l:'Ideal para probar.'
                },
                {
                    id:'b2', n:'ü•à PACK BARBER PRO', p:220, old:260, 
                    i:'https://i.ibb.co/JWLQ100r/image.jpg', 
                    imgs: ['https://i.ibb.co/JWLQ100r/image.jpg', 'https://i.ibb.co/5h9yL9X/image.jpg', 'https://i.ibb.co/23H4KxBp/image.jpg', 'https://i.ibb.co/ZRd9499Y/image.jpg'],
                    d:{es:'4 Ceras + Shampoo.', en:'4 Waxes + Shampoo.', he:'4 ◊ï◊ï◊ß◊° + ◊©◊û◊§◊ï.'}, l:'‚≠ê BEST SELLER', r:true
                },
                {
                    id:'b3', n:'ü•á FULL KATANA', p:350, old:420, 
                    i:'https://i.ibb.co/fV85Ftrt/image.jpg', 
                    imgs: ['https://i.ibb.co/fV85Ftrt/image.jpg', 'https://i.ibb.co/84BzXkzK/image.jpg', 'https://i.ibb.co/9mz9mwSz/image.jpg', 'https://i.ibb.co/23H4KxBp/image.jpg', 'https://i.ibb.co/ZRd9499Y/image.jpg', 'https://i.ibb.co/JWLQ100r/image.jpg'],
                    d:{es:'6 Productos + Regalo.', en:'6 Products + Gift.', he:'6 ◊û◊ï◊¶◊®◊ô◊ù + ◊û◊™◊†◊î.'}, l:'Experiencia completa.'
                }
            ],

            db: [
                {id:1, c:'wax', p:65, v:'150ml', i:'https://i.ibb.co/fd7XDP0h/image.jpg', n:{es:'Nishman 01 Gumgum',en:'Nishman 01 Gumgum',he:'◊†◊ô◊©◊û◊ü 01 ◊í◊ê◊ù-◊í◊ê◊ù'}, d:{es:'Brillo Alto - Aroma Chicle',en:'High Shine - Bubblegum',he:'◊ë◊®◊ß ◊í◊ë◊ï◊î - ◊û◊°◊ò◊ô◊ß'}, det:"Fijaci√≥n: 5/5 | Brillo: 5/5 | Base: Agua"},
                {id:2, c:'wax', p:65, v:'150ml', i:'https://i.ibb.co/JWLQ100r/image.jpg', n:{es:'Nishman 02 Sport',en:'Nishman 02 Sport',he:'◊†◊ô◊©◊û◊ü 02 ◊°◊§◊ï◊®◊ò'}, d:{es:'Brillo Alto - Aroma Sport',en:'High Shine - Sport Scent',he:'◊ë◊®◊ß ◊í◊ë◊ï◊î - ◊°◊§◊ï◊®◊ò'}, det:"Fijaci√≥n: 5/5 | Brillo: 5/5 | Aroma: Fresco"},
                {id:3, c:'wax', p:65, v:'150ml', i:'https://i.ibb.co/5h9yL9X/image.jpg', n:{es:'Nishman 05 Keratin',en:'Nishman 05 Keratin',he:'◊†◊ô◊©◊û◊ü 05 ◊ß◊®◊ò◊ô◊ü'}, d:{es:'Nutrici√≥n y Fijaci√≥n',en:'Nutrition & Hold',he:'◊î◊ñ◊†◊î ◊ï◊ê◊ó◊ô◊ñ◊î'}, det:"Contiene Keratina Real para cuidar el cabello."},
                {id:4, c:'wax', p:70, v:'150ml', i:'https://i.ibb.co/JWLQ100r/image.jpg', n:{es:'Kabuto Katana Grey',en:'Kabuto Katana Grey',he:'◊ß◊ê◊ë◊ï◊ò◊ï ◊ß◊ò◊ê◊†◊î ◊ê◊§◊ï◊®'}, d:{es:'Mate Fuerte - Arcilla',en:'Strong Matte - Clay',he:'◊û◊ê◊ò ◊ó◊ñ◊ß - ◊ó◊ô◊û◊®'}, det:"Efecto natural sin brillo. Arcilla premium."},
                {id:5, c:'beard', p:55, v:'75ml', i:'https://i.ibb.co/84BzXkzK/image.jpg', n:{es:'Aceite Barba Gold',en:'Gold Beard Oil',he:'◊©◊û◊ü ◊ñ◊ß◊ü ◊í◊ï◊ú◊ì'}, d:{es:'Nutrici√≥n Argan',en:'Argan Nutrition',he:'◊î◊ñ◊†◊î ◊ê◊®◊í◊ü'}, det:"Suaviza la barba y cuida la piel."},
                {id:6, c:'scent', p:50, v:'400ml', i:'https://i.ibb.co/ZRd9499Y/image.jpg', n:{es:'Colonia No.11',en:'Cologne No.11',he:'◊ß◊ï◊ú◊ï◊†◊ô◊î ◊û◊° 11'}, d:{es:'Aroma Fresco',en:'Fresh Scent',he:'◊†◊ô◊ó◊ï◊ó ◊®◊¢◊†◊ü'}, det:"Ideal para despu√©s del afeitado."},
                {id:7, c:'powder', p:60, v:'20g', i:'https://i.ibb.co/fV85Ftrt/image.jpg', n:{es:'Styling Powder P1',en:'Styling Powder P1',he:'◊§◊ï◊ì◊®◊™ ◊¢◊ô◊¶◊ï◊ë P1'}, d:{es:'Volumen Mate',en:'Matte Volume',he:'◊†◊§◊ó ◊û◊ê◊ò'}, det:"Efecto nieve. Volumen instant√°neo."},
                {id:9, c:'wash', p:70, v:'1000ml', i:'https://i.ibb.co/23H4KxBp/image.jpg', n:{es:'Shampoo Keratina',en:'Keratin Shampoo',he:'◊©◊û◊§◊ï ◊ß◊®◊ò◊ô◊ü'}, d:{es:'Sin Sal - 1 Litro',en:'Salt Free - 1 Liter',he:'◊ú◊ú◊ê ◊û◊ú◊ó - 1 ◊ú◊ô◊ò◊®'}, det:"Uso profesional. Sin sales da√±inas."}
            ],

            texts: {
                es: { cart:"CARRITO", btn:"ENVIAR PEDIDO WHATSAPP", empty:"Carrito vac√≠o", sub:"Distribuidor Oficial Exclusivo", cardName:"Titular", cardNum:"N√∫mero", cardExp:"MM/AA", cardCvv:"CVV", total:"TOTAL", comboTitle:"PAQUETES PROFESIONALES (AHORRO)", upsell:"COMPLETA TU PACK", b2bBtn:"VENTAS AL MAYOR", b2bTitle:"ZONA DISTRIBUIDOR", lionHello:"Soy Leo, tu asistente. ¬øEn qu√© te ayudo?", l1:"üì¶ Env√≠os", l2:"üí∞ Pagos", l3:"üìç Ubicaci√≥n", r1:"Env√≠os GRATIS > 300‚Ç™", r2:"Efectivo, Tarjeta o Transferencia", r3:"Online en Tel Aviv", cats:{all:"TODO", wax:"CERAS", beard:"BARBA", scent:"AROMAS", powder:"POLVO", wash:"SHAMPOO"}, namePh:"Nombre Completo", addrPh:"Direcci√≥n Exacta" },
                en: { cart:"CART", btn:"CONFIRM ORDER WHATSAPP", empty:"Cart empty", sub:"Exclusive Official Distributor", cardName:"Name", cardNum:"Number", cardExp:"MM/YY", cardCvv:"CVV", total:"TOTAL", comboTitle:"PROFESSIONAL BUNDLES (SAVE)", upsell:"COMPLETE YOUR PACK", b2bBtn:"WHOLESALE", b2bTitle:"WHOLESALE ZONE", lionHello:"I'm Leo, your assistant. How can I help?", l1:"üì¶ Shipping", l2:"üí∞ Payment", l3:"üìç Location", r1:"FREE Shipping > 300‚Ç™", r2:"Cash, Card or Transfer", r3:"Online in Tel Aviv", cats:{all:"ALL", wax:"WAXES", beard:"BEARD", scent:"SCENTS", powder:"POWDER", wash:"SHAMPOO"}, namePh:"Full Name", addrPh:"Exact Address" },
                he: { cart:"◊¢◊í◊ú◊î", btn:"◊©◊ú◊ó ◊î◊ñ◊û◊†◊î ◊ë◊ï◊ï◊ê◊ò◊°◊ê◊§", empty:"◊®◊ô◊ß", sub:"◊û◊§◊ô◊• ◊®◊©◊û◊ô ◊ë◊ú◊¢◊ì◊ô", cardName:"◊©◊ù", cardNum:"◊û◊°◊§◊®", cardExp:"◊™◊ï◊ß◊£", cardCvv:"CVV", total:"◊°◊î◊¥◊õ", comboTitle:"◊ó◊ë◊ô◊ú◊ï◊™ ◊û◊ß◊¶◊ï◊¢◊ô◊ï◊™ (◊ó◊ô◊°◊õ◊ï◊ü)", upsell:"◊î◊©◊ú◊ù ◊ê◊™ ◊î◊ó◊ë◊ô◊ú◊î", b2bBtn:"◊°◊ô◊ò◊ï◊†◊ê◊ï◊™", b2bTitle:"◊ê◊ñ◊ï◊® ◊°◊ô◊ò◊ï◊†◊ê◊ô", lionHello:"◊ê◊†◊ô ◊ú◊ê◊ï, ◊î◊¢◊ï◊ñ◊® ◊©◊ú◊ö. ◊ê◊ô◊ö ◊ú◊¢◊ñ◊ï◊®?", l1:"üì¶ ◊û◊©◊ú◊ï◊ó◊ô◊ù", l2:"üí∞ ◊™◊©◊ú◊ï◊ù", l3:"üìç ◊û◊ô◊ß◊ï◊ù", r1:"◊û◊©◊ú◊ï◊ó ◊ó◊ô◊†◊ù ◊û◊¢◊ú 300‚Ç™", r2:"◊û◊ñ◊ï◊û◊ü, ◊ê◊©◊®◊ê◊ô ◊ê◊ï ◊î◊¢◊ë◊®◊î", r3:"◊ê◊ï◊†◊ú◊ô◊ô◊ü ◊ë◊™◊ú ◊ê◊ë◊ô◊ë", cats:{all:"◊î◊õ◊ú", wax:"◊ï◊ï◊ß◊°", beard:"◊ñ◊ß◊ü", scent:"◊†◊ô◊ó◊ï◊ó◊ï◊™", powder:"◊§◊ï◊ì◊®◊î", wash:"◊©◊û◊§◊ï"}, namePh:"◊©◊ù ◊û◊ú◊ê", addrPh:"◊õ◊™◊ï◊ë◊™ ◊û◊ú◊ê◊î" }
            },

            init: function() { 
                this.setLang('es'); 
                this.setPayment('card');
                setTimeout(() => { this.renderCombos(); this.renderGrid(); }, 100);
            },

            setLang: function(l) {
                this.lang = l; document.body.dir = (l==='he')?'rtl':'ltr';
                ['es','en','he'].forEach(x => {
                    const el = document.getElementById('l-'+x);
                    if(el) el.className = (x===l) ? "px-2 py-1 text-[10px] font-bold bg-white text-black rounded" : "px-2 py-1 text-[10px] text-gray-400";
                });
                this.updateUI();
            },

            updateUI: function() {
                const t = this.texts[this.lang];
                document.getElementById('txt-hero-sub').innerText = t.sub;
                document.getElementById('txt-cart-title').innerText = t.cart;
                document.getElementById('btn-final-order').innerText = t.btn;
                document.getElementById('txt-combo-title').innerText = t.comboTitle;
                document.getElementById('txt-upsell-title').innerText = t.upsell;
                document.getElementById('txt-total-label').innerText = t.total;
                document.getElementById('txt-btn-b2b').innerText = t.b2bBtn;
                document.getElementById('txt-b2b-modal-title').innerText = t.b2bTitle;
                document.getElementById('cust-name').placeholder = t.namePh;
                document.getElementById('cust-addr').placeholder = t.addrPh;
                
                const cats = document.getElementById('cats-container');
                cats.innerHTML = Object.keys(t.cats).map(c => `<button onclick="app.filter('${c}')" id="cat-${c}" class="cat-btn ${c==='all'?'active':''}">${t.cats[c]}</button>`).join('');
                
                this.renderCombos();
                this.renderGrid();
                this.renderCart();
            },

            renderCombos: function() {
                const grid = document.getElementById('combo-grid');
                grid.innerHTML = this.bundles.map(b => `
                    <div class="glass-card p-4 relative border-2 ${b.r ? 'border-gold' : 'border-gray-800'}">
                        ${b.r ? '<div class="led-flash">‚≠ê BEST SELLER</div>' : '<div class="led-flash">SAVE 15%</div>'}
                        
                        <div class="mb-4 mt-6">
                            <div class="bundle-grid">
                                ${b.imgs.map(src => `<img src="${src}">`).join('')}
                            </div>
                        </div>

                        <h3 class="text-white font-bold text-center text-sm uppercase">${b.n}</h3>
                        <p class="text-[10px] text-gray-400 text-center mb-2">${b.d[this.lang]}</p>
                        <p class="text-[9px] text-gold font-bold italic text-center mb-3">"${b.l}"</p>
                        <div class="flex justify-between items-center bg-black/50 p-2 rounded-lg">
                            <div>
                                <span class="old-price">${this.fmt(b.old)}</span>
                                <span class="text-lg font-bold gold-text">${this.fmt(b.p)}</span>
                            </div>
                            <button onclick="app.addBundle('${b.id}')" class="bg-gold text-black px-3 py-1 rounded-full font-bold text-[9px] uppercase active:scale-95 transition">+ AGREGAR</button>
                        </div>
                    </div>`).join('');
            },

            toggleCurrency: function() { this.curr=(this.curr==='ILS')?'USD':'ILS'; document.getElementById('btn-curr').innerText=(this.curr==='ILS')?'‚Ç™ ILS':'$ USD'; this.updateUI(); },
            fmt: function(p) { return (this.curr==='ILS')?`${p} ‚Ç™`:`$${(p/this.rate).toFixed(2)}`; },
            filter: function(c) { document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active')); document.getElementById('cat-'+c).classList.add('active'); this.renderGrid(); },

            renderGrid: function() {
                const c = document.querySelector('.cat-btn.active')?.id.replace('cat-','') || 'all';
                const list = (c==='all') ? this.db : this.db.filter(x=>x.c===c);
                document.getElementById('product-grid').innerHTML = list.map(p => `
                    <div class="glass-card flex flex-col h-full animate-fade-in">
                        <div class="h-44 bg-black/40 flex justify-center items-center p-3 relative"><img src="${p.i}" class="h-36 object-contain drop-shadow-2xl"><span class="absolute top-2 right-2 bg-black/60 text-white text-[9px] px-2 py-1 rounded font-bold">${p.v}</span></div>
                        <div class="p-3 flex flex-col flex-1 text-left">
                            <h3 class="text-white font-bold text-xs uppercase mb-1">${p.n[this.lang]}</h3>
                            <p class="text-[9px] text-gray-400 mb-2 flex-1 italic">${p.d[this.lang]}</p>
                            <div class="flex justify-between items-center mt-auto pt-2 border-t border-gray-800">
                                <span class="text-sm font-bold gold-text">${this.fmt(p.p)}</span>
                                <div class="flex gap-2">
                                    <button onclick="alert('${p.det}')" class="bg-gray-800 text-gray-300 w-7 h-7 rounded-full text-[10px] flex items-center justify-center border border-gray-600"><i class="fa-solid fa-info"></i></button>
                                    <button onclick="app.add(${p.id})" class="bg-gold text-black px-3 py-1 rounded-full text-[10px] font-bold uppercase active:scale-95 transition">AGREGAR</button>
                                </div>
                            </div>
                        </div>
                    </div>`).join('');
            },

            add: function(id) { document.getElementById('snd-add').play().catch(()=>{}); const p = this.db.find(x=>x.id===id); const ex = this.cart.find(x=>x.id===id); if(ex) ex.qty++; else this.cart.push({...p,qty:1,isBundle:false}); this.renderCart(); },
            addBundle: function(id) { document.getElementById('snd-add').play().catch(()=>{}); const b = this.bundles.find(x=>x.id===id); const ex = this.cart.find(x=>x.id===id); if(ex) ex.qty++; else this.cart.push({...b,qty:1,isBundle:true}); this.renderCart(); this.toggleCart(true); },

            renderCart: function() {
                document.getElementById('badge').innerText = this.cart.reduce((a,b)=>a+b.qty,0);
                const list = document.getElementById('cart-items');
                if(!this.cart.length) list.innerHTML = `<p class="text-center py-10 opacity-50 text-xs">${this.texts[this.lang].empty}</p>`;
                else list.innerHTML = this.cart.map((i,x) => `<div class="flex gap-3 bg-[#111] p-3 rounded-2xl border border-gray-800 items-center"><img src="${i.i}" class="w-10 h-10 object-contain"><div class="flex-1 text-left"><div class="text-[10px] text-white font-bold uppercase">${i.isBundle ? i.n : i.n[this.lang]}</div><div class="text-[11px] gold-text font-bold">${i.qty} x ${this.fmt(i.p)}</div></div><div class="flex items-center gap-2 bg-black rounded-xl p-1 border border-gray-800"><button onclick="app.mod(${x},-1)" class="w-7 h-7 text-white">-</button><span class="text-xs font-bold text-white">${i.qty}</span><button onclick="app.mod(${x},1)" class="w-7 h-7 text-white">+</button></div></div>`).join('');
                document.getElementById('final-total').innerText = this.fmt(this.cart.reduce((a,b)=>a+(b.p*b.qty),0));
                this.renderUpsell();
            },

            renderUpsell: function() {
                const available = this.db.filter(p => !this.cart.some(c=>c.id===p.id));
                const shuffle = available.sort(() => 0.5 - Math.random()).slice(0, 2);
                document.getElementById('upsell-grid').innerHTML = shuffle.map(p => `
                    <div class="bg-[#111] p-2 rounded-xl border border-gray-900 flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <img src="${p.i}" class="h-8 object-contain">
                            <div class="text-[9px] text-white uppercase font-bold truncate max-w-[80px]">${p.n[this.lang]}</div>
                        </div>
                        <button onclick="app.add(${p.id})" class="text-gold text-[12px] font-bold"><i class="fa-solid fa-plus-circle"></i></button>
                    </div>`).join('');
            },

            mod: function(i,d) { this.cart[i].qty+=d; if(this.cart[i].qty<=0) this.cart.splice(i,1); this.renderCart(); },
            toggleCart: function(f) { const m = document.getElementById('cart-modal'); if(f) m.classList.remove('hide'); else m.classList.toggle('hide'); },
            
            toggleLion: function() { 
                const msg = document.getElementById('robot-msg');
                const content = document.getElementById('robot-content');
                const t = this.texts[this.lang];
                
                if(msg.classList.contains('hide')) {
                    content.innerHTML = `
                        <p class="mb-2 font-bold text-gold">${t.lionHello}</p>
                        <div class="flex flex-col gap-2">
                            <button onclick="app.robotReply(1)" class="bg-gray-100 px-2 py-2 rounded text-[10px] text-left hover:bg-gold hover:text-white transition">${t.l1}</button>
                            <button onclick="app.robotReply(2)" class="bg-gray-100 px-2 py-2 rounded text-[10px] text-left hover:bg-gold hover:text-white transition">${t.l2}</button>
                            <button onclick="app.robotReply(3)" class="bg-gray-100 px-2 py-2 rounded text-[10px] text-left hover:bg-gold hover:text-white transition">${t.l3}</button>
                        </div>`;
                    msg.classList.remove('hide');
                } else {
                    msg.classList.add('hide');
                }
            },

            robotReply: function(opt) {
                const t = this.texts[this.lang];
                const content = document.getElementById('robot-content');
                if(opt === 1) content.innerHTML = `<p class="text-[10px]">${t.r1}</p>`;
                if(opt === 2) content.innerHTML = `<p class="text-[10px]">${t.r2}</p>`;
                if(opt === 3) content.innerHTML = `<p class="text-[10px]">${t.r3}</p>`;
            },

            setView: function(v) { document.getElementById('view-shop').classList.add('hide'); document.getElementById('view-b2b').classList.add('hide'); document.getElementById('view-'+v).classList.remove('hide'); },

            setPayment: function(t) {
                this.payMethod=t; const d=document.getElementById('payment-details');
                ['card','cash'].forEach(m => {
                    const btn = document.getElementById('pay-'+m);
                    if(btn) btn.className = (m===t) ? "flex-1 bg-gold text-black p-3 rounded-xl font-bold text-[10px] uppercase shadow-lg" : "flex-1 bg-[#1a1a1a] text-gray-500 p-3 rounded-xl font-bold text-[10px] uppercase";
                });
                if(t==='card') {
                    d.innerHTML=`<div class="space-y-3 text-left"><div><label class="text-[8px] uppercase font-bold text-gray-500">${this.texts[this.lang].cardName}</label><input type="text" id="cc-name" class="w-full bg-black border border-gray-800 p-2 rounded-xl text-xs text-white"></div><div><label class="text-[8px] uppercase font-bold text-gray-500">${this.texts[this.lang].cardNum}</label><input type="text" id="cc-num" maxlength="19" class="w-full bg-black border border-gray-800 p-2 rounded-xl text-xs text-white font-mono"></div><div class="flex gap-2"><div><label class="text-[8px] uppercase font-bold text-gray-500">${this.texts[this.lang].cardExp}</label><input type="text" id="cc-exp" class="w-full bg-black border border-gray-800 p-2 rounded-xl text-[10px] text-white text-center"></div><div><label class="text-[8px] uppercase font-bold text-gray-400">${this.texts[this.lang].cardCvv}</label><input type="text" id="cc-cvv" maxlength="3" class="w-full bg-black border border-gray-800 p-2 rounded-xl text-[10px] text-white text-center"></div></div></div>`;
                    d.classList.remove('hide');
                } else {
                    d.innerHTML=`<div class="text-[10px] text-gold font-bold italic text-left">üíµ Pago al recibir.</div>`;
                    d.classList.remove('hide');
                }
            },

            // --- FUNCI√ìN CHECKOUT SIMPLIFICADA (V36) ---
            checkout: function() {
                const nameInput = document.getElementById('cust-name');
                const addrInput = document.getElementById('cust-addr');
                const n = nameInput.value.trim();
                const a = addrInput.value.trim();

                let error = false;
                if(!n) { nameInput.classList.add('input-error'); error = true; } else nameInput.classList.remove('input-error');
                if(!a) { addrInput.classList.add('input-error'); error = true; } else addrInput.classList.remove('input-error');

                if(error) return; // Si falta info, solo marca borde rojo
                if(this.cart.length === 0) return;

                let p_info = (this.payMethod === 'card') ? `üí≥ *TARJETA:*%0A- Titular: ${document.getElementById('cc-name')?.value || 'N/A'}%0A- Numero: ${document.getElementById('cc-num')?.value || 'N/A'}` : `üíµ *PAGO EFECTIVO*`;

                let list = ""; this.cart.forEach(i => { list += `‚Ä¢ ${i.qty}x ${i.isBundle ? i.n : i.n.es} (${this.fmt(i.p*i.qty)})%0A`; });
                const msg = `ü¶Å *PEDIDO ISTANBUL*%0Aüë§ *CLIENTE:* ${n}%0Aüìç *DIR:* ${a}%0A%0Aüì¶ *ITEMS:*%0A${list}%0A${p_info}%0A%0Aüí∞ *TOTAL:* ${document.getElementById('final-total').innerText}`;
                
                // FORZAR APERTURA - M√âTODO CL√ÅSICO
                const url = `https://wa.me/${this.whatsapp}?text=${encodeURIComponent(msg)}`;
                
                // Intento 1: Nueva pesta√±a
                const win = window.open(url, '_blank');
                // Intento 2: Redirecci√≥n directa si bloquean popups
                if(!win) window.location.href = url;
            },

            // --- FUNCI√ìN B2B SIMPLIFICADA (V36) ---
            handleB2B: function() {
                const n = document.getElementById('in-b2b-name').value;
                const c = document.getElementById('in-b2b-city').value;
                const d = document.getElementById('in-b2b-desc').value;

                if(!n || !c) { alert("Completa nombre y ciudad"); return; }

                const m = `üíº *DISTRIBUIDOR*%0Aüë§ *Nombre:* ${n}%0Aüìç *Ciudad:* ${c}%0Aüìù *Nota:* ${d}%0AQuiero precios mayoristas.`;
                const url = `https://wa.me/${this.whatsapp}?text=${encodeURIComponent(m)}`;
                
                const win = window.open(url, '_blank');
                if(!win) window.location.href = url;
            }
        };
        
        window.onload = () => app.init();
    </script>
</body>
</html>


